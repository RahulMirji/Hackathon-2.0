# Testing API Question Generation

## Issue
Questions in the exam section are not being generated by the API (getting 500 errors).

## Possible Causes

### 1. Missing Environment Variables
Check if `.env` or `.env.local` has all required variables:
```env
AI_API_URL=https://vanchin.streamlake.ai/api/gateway/v1/endpoints/chat/completions
AI_API_KEY="l96uptiQdNqY461IFfwWQMcTyjN-kSYsVIPwT4hXlCg"
AI_MODEL=ep-70wrsi-1759330065549240341
AI_PROVIDER=DeepInfra
```

### 2. API Endpoint Issues
- API URL might be incorrect or unreachable
- API Key might be invalid or expired
- Model name might be wrong

### 3. Check Server Logs
Look for errors in the terminal where `npm run dev` is running:
```
POST /api/generate-questions 500 in 246ms
```

## How to Debug

### Step 1: Check Environment Variables
```bash
# In secure-exam-frontend directory
cat .env
```

Make sure all variables are set correctly.

### Step 2: Test API Directly
Create a test file to check if the API is working:

```typescript
// test-api.ts
const API_URL = "https://vanchin.streamlake.ai/api/gateway/v1/endpoints/chat/completions"
const API_KEY = "l96uptiQdNqY461IFfwWQMcTyjN-kSYsVIPwT4hXlCg"
const MODEL = "ep-70wrsi-1759330065549240341"

async function testAPI() {
  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`,
      },
      body: JSON.stringify({
        model: MODEL,
        messages: [
          {
            role: "user",
            content: "Generate 2 simple math questions in JSON format"
          }
        ],
        temperature: 0.7,
      }),
    })

    console.log("Status:", response.status)
    const text = await response.text()
    console.log("Response:", text)
  } catch (error) {
    console.error("Error:", error)
  }
}

testAPI()
```

### Step 3: Check API Route
The API route is at: `app/api/generate-questions/route.ts`

It validates environment variables on startup:
```typescript
if (!API_URL || !API_KEY || !MODEL) {
  console.error("‚ùå Missing required environment variables:")
  if (!API_URL) console.error("  - AI_API_URL")
  if (!API_KEY) console.error("  - AI_API_KEY")
  if (!MODEL) console.error("  - AI_MODEL")
  throw new Error("Missing required AI configuration")
}
```

### Step 4: Check Browser Console
Open browser DevTools (F12) and check:
1. Network tab - Look for `/api/generate-questions` requests
2. Console tab - Look for error messages
3. Check the response body of failed requests

## Common Fixes

### Fix 1: Restart Development Server
After changing `.env` file:
```bash
# Stop the server (Ctrl+C)
# Start again
npm run dev
```

### Fix 2: Check API Provider
The API might need `AI_PROVIDER` variable:
```env
AI_PROVIDER=DeepInfra
```

### Fix 3: Use Mock Questions (Temporary)
If API is down, the system should automatically fall back to mock questions.
Check `lib/question-service.ts` - it has fallback logic.

### Fix 4: Check API Quotas
- API might have rate limits
- API key might have expired
- Check with API provider

## Expected Behavior

When working correctly:
1. User goes to `/exam/sections`
2. System calls `/api/generate-questions` for each section
3. API generates questions using AI
4. Questions are cached in localStorage
5. User can start exam

## Current Behavior

Getting 500 errors means:
- API route is being called
- But something fails during execution
- Check server terminal for detailed error messages

## Next Steps

1. Check server terminal for error details
2. Verify all environment variables are set
3. Test API endpoint directly
4. Check if API provider is working
5. Consider using fallback mock questions temporarily
